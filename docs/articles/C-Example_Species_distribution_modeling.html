<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cito">
<title>Example: (Multi-) Species distribution models with cito • cito</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example: (Multi-) Species distribution models with cito">
<meta property="og:description" content="cito">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cito</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/A-Introduction_to_cito.html">Introduction to cito</a>
    <a class="dropdown-item" href="../articles/B-Training_neural_networks.html">Training neural networks</a>
    <a class="dropdown-item" href="../articles/C-Example_Species_distribution_modeling.html">Example: (Multi-) Species distribution models with cito</a>
    <a class="dropdown-item" href="../articles/D-Advanced_custom_loss_functions.html">Advanced: Custom loss functions and prediction intervals</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/citoverse/cito/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example: (Multi-) Species distribution models with cito</h1>
                        <h4 data-toc-skip class="author">Maximilian
Pichler</h4>
            
            <h4 data-toc-skip class="date">2023-09-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/citoverse/cito/blob/HEAD/vignettes/C-Example_Species_distribution_modeling.Rmd" class="external-link"><code>vignettes/C-Example_Species_distribution_modeling.Rmd</code></a></small>
      <div class="d-none name"><code>C-Example_Species_distribution_modeling.Rmd</code></div>
    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      This vignette shows working examples of how to fit (multi-)
      species distribution models with cito. Training neural networks is
      tricky compared to other ML algorithms that converge more easily
      (due to various reasons). The purpose of this vignette is to
      provide an example workflow and to point out common caveats when
      training a neural network
    </div>
    
<div class="section level2">
<h2 id="species-distribution-model---african-elephant">Species distribution model - African elephant<a class="anchor" aria-label="anchor" href="#species-distribution-model---african-elephant"></a>
</h2>
<p>The goal is to build a SDM for the African elephant. A pre-processed
dataset from <a href="https://zenodo.org/record/4048271" class="external-link">Angelov,
2020</a> can be found in the EcoData package which is only available on
github:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TheoreticalEcology/" class="external-link">EcoData</a></span><span class="op">)</span><span class="op">)</span> <span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span>repo <span class="op">=</span> <span class="st">"TheoreticalEcology/EcoData"</span>, </span>
<span>                         dependencies <span class="op">=</span> <span class="cn">FALSE</span>, build_vignettes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: EcoData</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TheoreticalEcology/" class="external-link">EcoData</a></span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="fu">EcoData</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/EcoData/man/elephant.html" class="external-link">elephant</a></span><span class="op">$</span><span class="va">occurenceData</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Presence       bio1       bio2       bio3       bio4        bio5</span></span>
<span><span class="co">#&gt; 3364         0 -0.4981747 -0.2738045  0.5368968 -0.5409999 -0.36843571</span></span>
<span><span class="co">#&gt; 6268         0  0.6085908 -0.5568352  1.0340686 -1.2492050 -0.11835651</span></span>
<span><span class="co">#&gt; 10285        0 -0.7973005  1.4648130 -1.0540532  2.0759423  0.07614953</span></span>
<span><span class="co">#&gt; 2247         0  0.6385034  1.3435141 -0.1591439 -0.5107148  1.10425291</span></span>
<span><span class="co">#&gt; 9821         0  0.6684160 -0.6781341  0.6363311 -0.9906170  0.15950927</span></span>
<span><span class="co">#&gt; 1351         0  0.9675418 -0.6781341 -0.3580126 -0.3748202  0.77081398</span></span>
<span><span class="co">#&gt;             bio6       bio7       bio8       bio9       bio10       bio11</span></span>
<span><span class="co">#&gt; 3364   0.2947850 -0.5260099 -1.2253960  0.2494100 -0.64527314 -0.06267842</span></span>
<span><span class="co">#&gt; 6268   0.8221087 -0.8938475  0.4233787  0.7746249  0.09168503  0.94419518</span></span>
<span><span class="co">#&gt; 10285 -1.5860029  1.6284678  0.2768209 -1.5153122 -0.03648161 -1.44165748</span></span>
<span><span class="co">#&gt; 2247  -0.1622288  0.8577603  0.4600181  0.5855475  0.54026827  0.68153250</span></span>
<span><span class="co">#&gt; 9821   0.9099960 -0.8062671  0.3867393  0.8586593  0.31597665  0.94419518</span></span>
<span><span class="co">#&gt; 1351   0.8748411 -0.3858812  0.3134604  1.0477367  0.98885151  0.94419518</span></span>
<span><span class="co">#&gt;            bio12      bio13       bio14        bio15      bio16      bio17</span></span>
<span><span class="co">#&gt; 3364   0.6285371  0.6807958 -0.29703736 -0.008455252  0.7124535 -0.2949994</span></span>
<span><span class="co">#&gt; 6268   1.1121516  0.5918442  0.01619202 -0.884507980  0.5607328  0.3506918</span></span>
<span><span class="co">#&gt; 10285 -1.2351482 -1.3396742 -0.50585695  0.201797403 -1.3499999 -0.5616980</span></span>
<span><span class="co">#&gt; 2247   0.5951165  0.8714061 -0.55806185  0.236839512  1.1012378 -0.5616980</span></span>
<span><span class="co">#&gt; 9821   1.1003561  0.5537222  0.59044589 -1.024676416  0.6413344  0.7437213</span></span>
<span><span class="co">#&gt; 1351   0.7287986  1.1255533 -0.50585695  0.236839512  1.2956300 -0.4494038</span></span>
<span><span class="co">#&gt;             bio18       bio19</span></span>
<span><span class="co">#&gt; 3364  -1.06812752  1.96201807</span></span>
<span><span class="co">#&gt; 6268   1.22589281 -0.36205814</span></span>
<span><span class="co">#&gt; 10285 -0.42763181 -0.62895735</span></span>
<span><span class="co">#&gt; 2247  -0.20541902 -0.58378979</span></span>
<span><span class="co">#&gt; 9821   0.06254347 -0.05409751</span></span>
<span><span class="co">#&gt; 1351  -0.90473576  2.47939193</span></span></code></pre></div>
<p>Presence is our response variable and we have the 19 bioclim
variables as features/predictors.</p>
<p>Let’s split part of the data away so that we can use it at the end to
evaluate our model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="fl">300</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="va">indices</span>,<span class="op">]</span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="op">-</span><span class="va">indices</span>,<span class="op">]</span></span></code></pre></div>
<div class="section level3">
<h3 id="adjusting-optimization-parameters---convergence">Adjusting optimization parameters - Convergence<a class="anchor" aria-label="anchor" href="#adjusting-optimization-parameters---convergence"></a>
</h3>
<p>We will first try a simple DNN with default values and the binomial
likelihood. We use 30% of the data as validation holdout to check for
overfitting:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://citoverse.github.io/cito/" class="external-link">cito</a></span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="../reference/dnn.html">dnn</a></span><span class="op">(</span><span class="va">Presence</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">df</span>, </span>
<span>            batchsize <span class="op">=</span> <span class="fl">100L</span>, </span>
<span>            validation <span class="op">=</span> <span class="fl">0.3</span>, loss <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>            verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-4-1.png" width="400px" style="display: block; margin: auto;"></p>
<p>We see that the training and test losses were still decreasing which
means we didn’t train the model long enough. We could now either
increase the number of epochs or increase the learning rate so that the
model trains faster:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="../reference/dnn.html">dnn</a></span><span class="op">(</span><span class="va">Presence</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">df</span>, </span>
<span>            batchsize <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>            lr <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>            validation <span class="op">=</span> <span class="fl">0.3</span>, loss <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>            verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-5-1.png" width="400px" style="display: block; margin: auto;"></p>
<p>Much better! But still now enough epochs. Also, let’s see if we can
further decrease the loss by using a wider and deeper neural
network:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="../reference/dnn.html">dnn</a></span><span class="op">(</span><span class="va">Presence</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">df</span>, </span>
<span>            batchsize <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>            hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100L</span>, <span class="fl">100L</span>, <span class="fl">100L</span><span class="op">)</span>,</span>
<span>            lr <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>            validation <span class="op">=</span> <span class="fl">0.3</span>, loss <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>            verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-6-1.png" width="400px" style="display: block; margin: auto;"></p>
<p>At the end of the training, the losses start to get jumpy, which can
be a sign of potential overfitting. We can control that by adding a weak
regularization (but we only want a L2 regularization, so we set alpha to
1.0):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="../reference/dnn.html">dnn</a></span><span class="op">(</span><span class="va">Presence</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">df</span>, </span>
<span>            batchsize <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>            epochs <span class="op">=</span> <span class="fl">150L</span>,</span>
<span>            hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100L</span>, <span class="fl">100L</span>, <span class="fl">100L</span><span class="op">)</span>,</span>
<span>            lr <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>            lambda <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>            alpha <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>            validation <span class="op">=</span> <span class="fl">0.3</span>, loss <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>            verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-7-1.png" width="400px" style="display: block; margin: auto;"></p>
<p>We will turn on now advanced features that help with the convergence
and to reduce overfitting:</p>
<ul>
<li><p>learning rate scheduler - reduces learning rate during
training</p></li>
<li><p>early stopping - stop training when validation loss starts to
increase</p></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="../reference/dnn.html">dnn</a></span><span class="op">(</span><span class="va">Presence</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">df</span>, </span>
<span>            batchsize <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>            epochs <span class="op">=</span> <span class="fl">150L</span>,</span>
<span>            hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100L</span>, <span class="fl">100L</span>, <span class="fl">100L</span><span class="op">)</span>,</span>
<span>            lr <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>            lambda <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>            alpha <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>            validation <span class="op">=</span> <span class="fl">0.3</span>, loss <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>            verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            lr_scheduler <span class="op">=</span> <span class="fu"><a href="../reference/config_lr_scheduler.html">config_lr_scheduler</a></span><span class="op">(</span><span class="st">"reduce_on_plateau"</span>, patience <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>, <span class="co"># reduce learning rate each 7 epochs if the validation loss didn't decrease,</span></span>
<span>            early_stopping <span class="op">=</span> <span class="fl">14</span> <span class="co"># stop training when validation loss didn't decrease for 10 epochs</span></span>
<span>            <span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-8-1.png" width="400px" style="display: block; margin: auto;"></p>
<p>Great! We found now a model architecture and training procedure that
fits and trains well. Let’s proceed to our final model</p>
</div>
<div class="section level3">
<h3 id="train-final-model-with-bootstrapping-to-obtain-uncertainties">Train final model with bootstrapping to obtain uncertainties<a class="anchor" aria-label="anchor" href="#train-final-model-with-bootstrapping-to-obtain-uncertainties"></a>
</h3>
<p>We haven’t directly started with bootstrapping because it complicates
the adjustment of the training procedure.</p>
<p>Uncertainties can be obtained by using bootstrapping. Be aware that
this can be computational expensive:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_boot</span> <span class="op">=</span> <span class="fu"><a href="../reference/dnn.html">dnn</a></span><span class="op">(</span><span class="va">Presence</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">df</span>, </span>
<span>                 batchsize <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>                 epochs <span class="op">=</span> <span class="fl">150L</span>,</span>
<span>                 hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100L</span>, <span class="fl">100L</span>, <span class="fl">100L</span><span class="op">)</span>,</span>
<span>                 lr <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                 lambda <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>                 alpha <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>                 validation <span class="op">=</span> <span class="fl">0.3</span>, loss <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                 verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 lr_scheduler <span class="op">=</span> <span class="fu"><a href="../reference/config_lr_scheduler.html">config_lr_scheduler</a></span><span class="op">(</span><span class="st">"reduce_on_plateau"</span>, patience <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>, <span class="co"># reduce learning rate each 7 epochs if the validation loss didn't decrease,</span></span>
<span>                 early_stopping <span class="op">=</span> <span class="fl">14</span>, <span class="co"># stop training when validation loss didn't decrease for 10 epochs</span></span>
<span>                 bootstrap <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>                 bootstrap_parallel <span class="op">=</span> <span class="fl">5L</span></span>
<span>            <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="predictions">Predictions<a class="anchor" aria-label="anchor" href="#predictions"></a>
</h3>
<p>We can use the model now for predictions:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_boot</span>, newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">predictions</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  20 300   1</span></span></code></pre></div>
<p>The predictions are 2/3 dimensional because of the bootstrapping.
Calculate the AUC interval:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/auc.html" class="external-link">auc</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Presence</span>, <span class="va">predictions</span><span class="op">[</span><span class="va">i</span>,,<span class="op">]</span><span class="op">)</span><span class="op">)</span>, </span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"AUC of ensemble model"</span>, xlab <span class="op">=</span> <span class="st">"AUC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-11-1.png" width="400px" style="display: block; margin: auto;"></p>
<p>We can now predict the habitat suitability of the elephant (Note that
spatial dependencies are required):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: sp</span></span>
<span><span class="co">#&gt; The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">#&gt; which was just loaded, will retire in October 2023.</span></span>
<span><span class="co">#&gt; Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">#&gt; https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">#&gt; It may be desirable to make the sf package available;</span></span>
<span><span class="co">#&gt; package maintainers should consider adding sf to Suggests:.</span></span>
<span><span class="co">#&gt; The sp package is now running under evolution status 2</span></span>
<span><span class="co">#&gt;      (status 2 uses the sf package in place of rgdal)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org" class="external-link">rsample</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://latticeextra.r-forge.r-project.org/" class="external-link">latticeExtra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: lattice</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'lattice'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:EcoData':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     melanoma</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ggplot2'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:latticeExtra':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     layer</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://maptools.r-forge.r-project.org/" class="external-link">maptools</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Please note that 'maptools' will be retired during October 2023,</span></span>
<span><span class="co">#&gt; plan transition at your earliest convenience (see</span></span>
<span><span class="co">#&gt; https://r-spatial.org/r/2023/05/15/evolution4.html and earlier blogs</span></span>
<span><span class="co">#&gt; for guidance);some functionality will be moved to 'sp'.</span></span>
<span><span class="co">#&gt;  Checking rgeos availability: FALSE</span></span>
<span><span class="va">customPredictFun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="va">mean</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">normalized_raster</span> <span class="op">=</span> <span class="fu">EcoData</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/EcoData/man/elephant.html" class="external-link">elephant</a></span><span class="op">$</span><span class="va">predictionData</span></span>
<span></span>
<span><span class="va">predictions</span> <span class="op">=</span></span>
<span>  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">normalized_raster</span>,</span>
<span>                  <span class="va">model_boot</span>,</span>
<span>                  fun <span class="op">=</span> <span class="va">customPredictFun</span><span class="op">)</span></span>
<span></span>
<span><span class="va">habitat_plot</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/sp/man/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">predictions</span>, colorkey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op">)</span> </span>
<span><span class="va">habitat_plot</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-12-1.png" width="400px" style="display: block; margin: auto;"></p>
<p>Moreover, we can visualize the uncertainty of our model, instead of
calculating the average occurrence probability, we calculate for each
prediction the standard deviation and visualize it:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">customPredictFun_sd</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="va">sd</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">predictions</span> <span class="op">=</span></span>
<span>  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">normalized_raster</span>,</span>
<span>                  <span class="va">model_boot</span>,</span>
<span>                  fun <span class="op">=</span> <span class="va">customPredictFun_sd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">uncertain_plot</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/sp/man/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">predictions</span>, colorkey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>space <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op">)</span> </span>
<span><span class="va">uncertain_plot</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-13-1.png" width="400px" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="inference">Inference<a class="anchor" aria-label="anchor" href="#inference"></a>
</h3>
<p>Neural networks are often called black-box models but the tools of
explainable AI (xAI) allows us to understand them - and actually infer
properties similar to what a linear regression model can provide (the
calculation can take some time…):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_boot</span><span class="op">)</span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt; Summary of Deep Neural Network Model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;      Feature Importance </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;                   Importance Std.Err Z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Response_1: bio1     0.03401 0.01671    2.04  0.04177 *  </span></span>
<span><span class="co">#&gt; Response_1: bio2     0.02661 0.01036    2.57  0.01024 *  </span></span>
<span><span class="co">#&gt; Response_1: bio3     0.02331 0.00856    2.72  0.00646 ** </span></span>
<span><span class="co">#&gt; Response_1: bio4     0.02960 0.00984    3.01  0.00262 ** </span></span>
<span><span class="co">#&gt; Response_1: bio5     0.02113 0.01025    2.06  0.03915 *  </span></span>
<span><span class="co">#&gt; Response_1: bio6     0.02251 0.01103    2.04  0.04126 *  </span></span>
<span><span class="co">#&gt; Response_1: bio7     0.01617 0.00581    2.78  0.00539 ** </span></span>
<span><span class="co">#&gt; Response_1: bio8     0.02028 0.00576    3.52  0.00043 ***</span></span>
<span><span class="co">#&gt; Response_1: bio9     0.04867 0.02752    1.77  0.07695 .  </span></span>
<span><span class="co">#&gt; Response_1: bio10    0.01643 0.00470    3.50  0.00047 ***</span></span>
<span><span class="co">#&gt; Response_1: bio11    0.02497 0.01008    2.48  0.01326 *  </span></span>
<span><span class="co">#&gt; Response_1: bio12    0.03665 0.01200    3.05  0.00227 ** </span></span>
<span><span class="co">#&gt; Response_1: bio13    0.02090 0.01013    2.06  0.03917 *  </span></span>
<span><span class="co">#&gt; Response_1: bio14    0.04307 0.02033    2.12  0.03411 *  </span></span>
<span><span class="co">#&gt; Response_1: bio15    0.03344 0.00962    3.47  0.00051 ***</span></span>
<span><span class="co">#&gt; Response_1: bio16    0.05611 0.02028    2.77  0.00566 ** </span></span>
<span><span class="co">#&gt; Response_1: bio17    0.02026 0.00939    2.16  0.03097 *  </span></span>
<span><span class="co">#&gt; Response_1: bio18    0.03584 0.01038    3.45  0.00056 ***</span></span>
<span><span class="co">#&gt; Response_1: bio19    0.00992 0.00378    2.63  0.00861 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;      Average Conditional Effects </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;                       ACE Std.Err Z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Response_1: bio1   0.6875  0.5318    1.29  0.19611    </span></span>
<span><span class="co">#&gt; Response_1: bio2  -0.5535  0.3429   -1.61  0.10649    </span></span>
<span><span class="co">#&gt; Response_1: bio3  -0.5021  0.3076   -1.63  0.10261    </span></span>
<span><span class="co">#&gt; Response_1: bio4   0.6439  0.3794    1.70  0.08968 .  </span></span>
<span><span class="co">#&gt; Response_1: bio5   0.3595  0.5545    0.65  0.51676    </span></span>
<span><span class="co">#&gt; Response_1: bio6   0.4091  0.4576    0.89  0.37129    </span></span>
<span><span class="co">#&gt; Response_1: bio7  -0.0779  0.3198   -0.24  0.80750    </span></span>
<span><span class="co">#&gt; Response_1: bio8  -0.1774  0.3505   -0.51  0.61277    </span></span>
<span><span class="co">#&gt; Response_1: bio9  -1.3189  0.5187   -2.54  0.01101 *  </span></span>
<span><span class="co">#&gt; Response_1: bio10  0.0407  0.4426    0.09  0.92664    </span></span>
<span><span class="co">#&gt; Response_1: bio11 -0.3194  0.4971   -0.64  0.52058    </span></span>
<span><span class="co">#&gt; Response_1: bio12 -1.4857  0.4346   -3.42  0.00063 ***</span></span>
<span><span class="co">#&gt; Response_1: bio13  0.6268  0.5034    1.25  0.21312    </span></span>
<span><span class="co">#&gt; Response_1: bio14  1.5582  0.5845    2.67  0.00768 ** </span></span>
<span><span class="co">#&gt; Response_1: bio15 -0.2713  0.2778   -0.98  0.32877    </span></span>
<span><span class="co">#&gt; Response_1: bio16 -1.5872  0.4633   -3.43  0.00061 ***</span></span>
<span><span class="co">#&gt; Response_1: bio17  0.7053  0.4845    1.46  0.14548    </span></span>
<span><span class="co">#&gt; Response_1: bio18  0.0339  0.2157    0.16  0.87507    </span></span>
<span><span class="co">#&gt; Response_1: bio19 -0.3269  0.3970   -0.82  0.41025    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;      Standard Deviation of Conditional Effects </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;                     ACE Std.Err Z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Response_1: bio1  0.850   0.199    4.26  2.0e-05 ***</span></span>
<span><span class="co">#&gt; Response_1: bio2  0.694   0.179    3.87  0.00011 ***</span></span>
<span><span class="co">#&gt; Response_1: bio3  0.735   0.200    3.68  0.00023 ***</span></span>
<span><span class="co">#&gt; Response_1: bio4  0.975   0.250    3.90  9.6e-05 ***</span></span>
<span><span class="co">#&gt; Response_1: bio5  0.736   0.230    3.20  0.00136 ** </span></span>
<span><span class="co">#&gt; Response_1: bio6  0.611   0.167    3.67  0.00025 ***</span></span>
<span><span class="co">#&gt; Response_1: bio7  0.607   0.158    3.84  0.00012 ***</span></span>
<span><span class="co">#&gt; Response_1: bio8  0.913   0.186    4.91  9.2e-07 ***</span></span>
<span><span class="co">#&gt; Response_1: bio9  0.656   0.219    3.00  0.00271 ** </span></span>
<span><span class="co">#&gt; Response_1: bio10 0.642   0.154    4.16  3.2e-05 ***</span></span>
<span><span class="co">#&gt; Response_1: bio11 0.828   0.267    3.10  0.00194 ** </span></span>
<span><span class="co">#&gt; Response_1: bio12 0.937   0.281    3.33  0.00087 ***</span></span>
<span><span class="co">#&gt; Response_1: bio13 0.654   0.144    4.53  6.0e-06 ***</span></span>
<span><span class="co">#&gt; Response_1: bio14 1.017   0.233    4.37  1.2e-05 ***</span></span>
<span><span class="co">#&gt; Response_1: bio15 0.786   0.180    4.37  1.2e-05 ***</span></span>
<span><span class="co">#&gt; Response_1: bio16 1.019   0.293    3.48  0.00051 ***</span></span>
<span><span class="co">#&gt; Response_1: bio17 0.789   0.245    3.22  0.00129 ** </span></span>
<span><span class="co">#&gt; Response_1: bio18 1.764   0.385    4.59  4.5e-06 ***</span></span>
<span><span class="co">#&gt; Response_1: bio19 0.670   0.175    3.83  0.00013 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Bioclim9, 12, 14, and 16 have large significant average conditional
effects ($\approx$ linear effects). We can visualize them using
accumulated local effect plots:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ALE.html">ALE</a></span><span class="op">(</span><span class="va">model_boot</span>, variable <span class="op">=</span> <span class="st">"bio9"</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-15-1.png" width="400px" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ALE.html">ALE</a></span><span class="op">(</span><span class="va">model_boot</span>, variable <span class="op">=</span> <span class="st">"bio12"</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-15-2.png" width="400px" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ALE.html">ALE</a></span><span class="op">(</span><span class="va">model_boot</span>, variable <span class="op">=</span> <span class="st">"bio14"</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-15-3.png" width="400px" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ALE.html">ALE</a></span><span class="op">(</span><span class="va">model_boot</span>, variable <span class="op">=</span> <span class="st">"bio16"</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-15-4.png" width="400px" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="multi-species-distribution-model">Multi-species distribution model<a class="anchor" aria-label="anchor" href="#multi-species-distribution-model"></a>
</h2>
<p>Cito supports many different loss functions which we can use to build
multi-species distribution models (MSDM). MSDM are multi-label,
i.e. they model and predict simoustanously many responses. We will use
eucalypts data from <a href="https://besjournals.onlinelibrary.wiley.com/doi/10.1111/2041-210X.12180" class="external-link">Pollock
et al., 2014</a>. The dataset has occurrence of 12 species over 458
sites.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"https://github.com/TheoreticalEcology/s-jSDM/raw/master/sjSDM/data/eucalypts.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Environment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">eucalypts</span><span class="op">$</span><span class="va">env</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Rockiness Sandiness VallyBotFlat PPTann Loaminess cvTemp      T0</span></span>
<span><span class="co">#&gt; 1        60         1            0    785         0    142 6124.01</span></span>
<span><span class="co">#&gt; 2        75         1            0    785         0    142 6124.01</span></span>
<span><span class="co">#&gt; 3        70         1            0    780         0    142 3252.96</span></span>
<span><span class="co">#&gt; 4        40         1            0    778         0    142 1636.63</span></span>
<span><span class="co">#&gt; 5        15         1            0    772         0    142 1352.08</span></span>
<span><span class="co">#&gt; 6        80         1            0    841         0    142 5018.48</span></span>
<span></span>
<span><span class="co"># PA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">eucalypts</span><span class="op">$</span><span class="va">PA</span><span class="op">)</span></span>
<span><span class="co">#&gt;      ALA ARE BAX CAM GON MEL OBL OVA WIL ALP VIM ARO.SAB</span></span>
<span><span class="co">#&gt; [1,]   0   0   0   0   0   0   0   0   1   1   0       0</span></span>
<span><span class="co">#&gt; [2,]   0   0   0   0   0   0   1   0   1   1   0       0</span></span>
<span><span class="co">#&gt; [3,]   0   0   1   0   0   0   0   0   1   1   0       0</span></span>
<span><span class="co">#&gt; [4,]   0   0   1   0   0   0   0   0   1   0   0       0</span></span>
<span><span class="co">#&gt; [5,]   0   0   1   0   0   0   1   0   0   0   0       0</span></span>
<span><span class="co">#&gt; [6,]   0   0   0   0   0   0   0   0   1   1   0       0</span></span></code></pre></div>
<p>Bring data into a format that is usable by cito:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">eucalypts</span><span class="op">$</span><span class="va">PA</span>, <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">eucalypts</span><span class="op">$</span><span class="va">env</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;      ALA ARE BAX CAM GON MEL OBL OVA WIL ALP VIM ARO.SAB  Rockiness Sandiness</span></span>
<span><span class="co">#&gt; [1,]   0   0   0   0   0   0   0   0   1   1   0       0  1.0315338 0.5716827</span></span>
<span><span class="co">#&gt; [2,]   0   0   0   0   0   0   1   0   1   1   0       0  1.4558834 0.5716827</span></span>
<span><span class="co">#&gt; [3,]   0   0   1   0   0   0   0   0   1   1   0       0  1.3144335 0.5716827</span></span>
<span><span class="co">#&gt; [4,]   0   0   1   0   0   0   0   0   1   0   0       0  0.4657344 0.5716827</span></span>
<span><span class="co">#&gt; [5,]   0   0   1   0   0   0   1   0   0   0   0       0 -0.2415148 0.5716827</span></span>
<span><span class="co">#&gt; [6,]   0   0   0   0   0   0   0   0   1   1   0       0  1.5973333 0.5716827</span></span>
<span><span class="co">#&gt;      VallyBotFlat       PPTann  Loaminess    cvTemp         T0</span></span>
<span><span class="co">#&gt; [1,]   -0.5939667 -0.005981517 -0.2134535 -1.056073  0.5378148</span></span>
<span><span class="co">#&gt; [2,]   -0.5939667 -0.005981517 -0.2134535 -1.056073  0.5378148</span></span>
<span><span class="co">#&gt; [3,]   -0.5939667 -0.045456081 -0.2134535 -1.056073 -0.3404551</span></span>
<span><span class="co">#&gt; [4,]   -0.5939667 -0.061245907 -0.2134535 -1.056073 -0.8348993</span></span>
<span><span class="co">#&gt; [5,]   -0.5939667 -0.108615385 -0.2134535 -1.056073 -0.9219447</span></span>
<span><span class="co">#&gt; [6,]   -0.5939667  0.436133605 -0.2134535 -1.056073  0.1996271</span></span></code></pre></div>
<p>We will use the binomial likelihood - each species occurrence data
will be modeled by a binomial likelihood. Build simple model:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="../reference/dnn.html">dnn</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ALA</span>, <span class="va">ARE</span>, <span class="va">BAX</span>, <span class="va">CAM</span>, <span class="va">GON</span>, <span class="va">MEL</span>, <span class="va">OBL</span>, <span class="va">OVA</span>, <span class="va">WIL</span>, <span class="va">ALP</span>, <span class="va">VIM</span>, <span class="va">ARO.SAB</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>,</span>
<span>            data <span class="op">=</span> <span class="va">df</span>,</span>
<span>            verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            loss <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-18-1.png" width="400px" style="display: block; margin: auto;"></p>
<p>Plot model:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-19-1.png" width="400px" style="display: block; margin: auto;"></p>
<p>Our NN has now 12 output nodes, one for each species.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]       [,4]      [,5]       [,6]      [,7]</span></span>
<span><span class="co">#&gt; [1,] 0.1493295 0.1114065 0.3930047 0.09799559 0.1254564 0.10462441 0.2937151</span></span>
<span><span class="co">#&gt; [2,] 0.1451579 0.1077337 0.3930270 0.09073517 0.1218084 0.09643494 0.2817680</span></span>
<span><span class="co">#&gt; [3,] 0.1546754 0.1131142 0.3932407 0.09838057 0.1337184 0.10403256 0.2972646</span></span>
<span><span class="co">#&gt; [4,] 0.1653403 0.1198953 0.3907889 0.11330025 0.1415827 0.11506178 0.3310862</span></span>
<span><span class="co">#&gt; [5,] 0.1554572 0.1121355 0.3857582 0.11560974 0.1351131 0.11061426 0.3410180</span></span>
<span><span class="co">#&gt; [6,] 0.1477580 0.1013224 0.3912212 0.08623949 0.1202778 0.09009469 0.2768509</span></span>
<span><span class="co">#&gt;           [,8]      [,9]     [,10]     [,11]     [,12]</span></span>
<span><span class="co">#&gt; [1,] 0.1214905 0.2155782 0.1872236 0.1144877 0.1970614</span></span>
<span><span class="co">#&gt; [2,] 0.1156193 0.2088006 0.1835964 0.1077049 0.1839618</span></span>
<span><span class="co">#&gt; [3,] 0.1277948 0.2135392 0.1947827 0.1195972 0.1978883</span></span>
<span><span class="co">#&gt; [4,] 0.1368099 0.2260010 0.2022687 0.1319323 0.2238290</span></span>
<span><span class="co">#&gt; [5,] 0.1325549 0.2282125 0.1938089 0.1297426 0.2330296</span></span>
<span><span class="co">#&gt; [6,] 0.1148680 0.2013566 0.1883496 0.1093465 0.1709275</span></span></code></pre></div>
<div class="section level3">
<h3 id="train-model-with-bootstrapping">Train model with bootstrapping<a class="anchor" aria-label="anchor" href="#train-model-with-bootstrapping"></a>
</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_boot</span> <span class="op">=</span> <span class="fu"><a href="../reference/dnn.html">dnn</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ALA</span>, <span class="va">ARE</span>, <span class="va">BAX</span>, <span class="va">CAM</span>, <span class="va">GON</span>, <span class="va">MEL</span>, <span class="va">OBL</span>, <span class="va">OVA</span>, <span class="va">WIL</span>, <span class="va">ALP</span>, <span class="va">VIM</span>, <span class="va">ARO.SAB</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">df</span>,</span>
<span>                 loss <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                                  epochs <span class="op">=</span> <span class="fl">200L</span>,</span>
<span>                 hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50L</span>, <span class="fl">50L</span><span class="op">)</span>,</span>
<span>                 batchsize <span class="op">=</span> <span class="fl">50L</span>,</span>
<span>                 lr <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                 lambda <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>                 alpha <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>                 validation <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                 verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 lr_scheduler <span class="op">=</span> <span class="fu"><a href="../reference/config_lr_scheduler.html">config_lr_scheduler</a></span><span class="op">(</span><span class="st">"reduce_on_plateau"</span>, patience <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>, <span class="co"># reduce learning rate each 7 epochs if the validation loss didn't decrease,</span></span>
<span>                 early_stopping <span class="op">=</span> <span class="fl">14</span>, <span class="co"># stop training when validation loss didn't decrease for 10 epochs</span></span>
<span>                 bootstrap <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>                 bootstrap_parallel <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span></span></code></pre></div>
<p>We haven’t really adjusted the training procedure, so let’s check the
convergence first:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/analyze_training.html">analyze_training</a></span><span class="op">(</span><span class="va">model_boot</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inference-1">Inference<a class="anchor" aria-label="anchor" href="#inference-1"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_boot</span><span class="op">)</span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt; Summary of Deep Neural Network Model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;      Feature Importance </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;                           Importance   Std.Err Z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Response_1: Rockiness       3.45e-03  2.14e-03    1.61  0.10690    </span></span>
<span><span class="co">#&gt; Response_1: Sandiness       9.75e-04  6.66e-04    1.46  0.14364    </span></span>
<span><span class="co">#&gt; Response_1: VallyBotFlat    1.45e-03  9.88e-04    1.47  0.14192    </span></span>
<span><span class="co">#&gt; Response_1: PPTann          2.47e-03  1.31e-03    1.88  0.05988 .  </span></span>
<span><span class="co">#&gt; Response_1: Loaminess       3.84e-04  4.54e-04    0.85  0.39729    </span></span>
<span><span class="co">#&gt; Response_1: cvTemp          2.91e-03  1.22e-03    2.38  0.01719 *  </span></span>
<span><span class="co">#&gt; Response_1: T0              5.62e-04  7.25e-04    0.78  0.43826    </span></span>
<span><span class="co">#&gt; Response_2: Rockiness       4.30e-03  2.47e-03    1.74  0.08138 .  </span></span>
<span><span class="co">#&gt; Response_2: Sandiness       1.57e-03  9.39e-04    1.68  0.09372 .  </span></span>
<span><span class="co">#&gt; Response_2: VallyBotFlat    1.55e-03  1.23e-03    1.25  0.21038    </span></span>
<span><span class="co">#&gt; Response_2: PPTann          6.32e-03  3.09e-03    2.04  0.04124 *  </span></span>
<span><span class="co">#&gt; Response_2: Loaminess       5.41e-04  5.32e-04    1.02  0.30896    </span></span>
<span><span class="co">#&gt; Response_2: cvTemp          2.03e-02  9.85e-03    2.06  0.03969 *  </span></span>
<span><span class="co">#&gt; Response_2: T0              1.04e-03  6.52e-04    1.60  0.11021    </span></span>
<span><span class="co">#&gt; Response_3: Rockiness       1.04e-02  5.02e-03    2.06  0.03933 *  </span></span>
<span><span class="co">#&gt; Response_3: Sandiness       1.31e-02  6.02e-03    2.17  0.02973 *  </span></span>
<span><span class="co">#&gt; Response_3: VallyBotFlat    2.22e-02  7.96e-03    2.78  0.00537 ** </span></span>
<span><span class="co">#&gt; Response_3: PPTann          4.96e-03  3.16e-03    1.57  0.11683    </span></span>
<span><span class="co">#&gt; Response_3: Loaminess       6.28e-04  7.55e-04    0.83  0.40550    </span></span>
<span><span class="co">#&gt; Response_3: cvTemp          2.52e-02  9.70e-03    2.59  0.00951 ** </span></span>
<span><span class="co">#&gt; Response_3: T0              8.10e-04  9.58e-04    0.84  0.39825    </span></span>
<span><span class="co">#&gt; Response_4: Rockiness      -1.89e-03  1.51e-03   -1.25  0.20990    </span></span>
<span><span class="co">#&gt; Response_4: Sandiness       2.33e-03  1.41e-03    1.65  0.09899 .  </span></span>
<span><span class="co">#&gt; Response_4: VallyBotFlat    3.13e-03  2.32e-03    1.35  0.17725    </span></span>
<span><span class="co">#&gt; Response_4: PPTann         -1.17e-03  1.01e-03   -1.16  0.24770    </span></span>
<span><span class="co">#&gt; Response_4: Loaminess       1.87e-03  1.32e-03    1.41  0.15771    </span></span>
<span><span class="co">#&gt; Response_4: cvTemp          1.30e-04  1.08e-03    0.12  0.90423    </span></span>
<span><span class="co">#&gt; Response_4: T0              3.15e-04  5.89e-04    0.54  0.59205    </span></span>
<span><span class="co">#&gt; Response_5: Rockiness       1.31e-02  6.88e-03    1.91  0.05642 .  </span></span>
<span><span class="co">#&gt; Response_5: Sandiness       1.91e-03  9.89e-04    1.93  0.05409 .  </span></span>
<span><span class="co">#&gt; Response_5: VallyBotFlat    3.04e-03  1.49e-03    2.04  0.04087 *  </span></span>
<span><span class="co">#&gt; Response_5: PPTann          1.31e-02  5.85e-03    2.24  0.02519 *  </span></span>
<span><span class="co">#&gt; Response_5: Loaminess       1.00e-03  5.54e-04    1.81  0.07104 .  </span></span>
<span><span class="co">#&gt; Response_5: cvTemp          4.00e-02  1.50e-02    2.67  0.00770 ** </span></span>
<span><span class="co">#&gt; Response_5: T0              2.13e-03  1.89e-03    1.13  0.26018    </span></span>
<span><span class="co">#&gt; Response_6: Rockiness       1.65e-03  1.35e-03    1.22  0.22123    </span></span>
<span><span class="co">#&gt; Response_6: Sandiness       1.49e-03  9.95e-04    1.49  0.13497    </span></span>
<span><span class="co">#&gt; Response_6: VallyBotFlat    2.78e-03  1.48e-03    1.88  0.05998 .  </span></span>
<span><span class="co">#&gt; Response_6: PPTann          1.02e-03  9.03e-04    1.13  0.25832    </span></span>
<span><span class="co">#&gt; Response_6: Loaminess       1.44e-03  4.13e-04    3.48  0.00049 ***</span></span>
<span><span class="co">#&gt; Response_6: cvTemp          2.13e-03  1.20e-03    1.77  0.07631 .  </span></span>
<span><span class="co">#&gt; Response_6: T0              3.32e-06  4.44e-04    0.01  0.99403    </span></span>
<span><span class="co">#&gt; Response_7: Rockiness       7.28e-03  3.26e-03    2.23  0.02566 *  </span></span>
<span><span class="co">#&gt; Response_7: Sandiness       3.81e-03  2.14e-03    1.78  0.07490 .  </span></span>
<span><span class="co">#&gt; Response_7: VallyBotFlat    8.37e-03  3.33e-03    2.51  0.01200 *  </span></span>
<span><span class="co">#&gt; Response_7: PPTann          2.95e-03  1.78e-03    1.66  0.09735 .  </span></span>
<span><span class="co">#&gt; Response_7: Loaminess       3.21e-03  3.54e-03    0.91  0.36432    </span></span>
<span><span class="co">#&gt; Response_7: cvTemp          1.45e-02  6.58e-03    2.20  0.02790 *  </span></span>
<span><span class="co">#&gt; Response_7: T0              1.01e-03  1.25e-03    0.81  0.41999    </span></span>
<span><span class="co">#&gt; Response_8: Rockiness      -8.85e-04  1.01e-03   -0.87  0.38252    </span></span>
<span><span class="co">#&gt; Response_8: Sandiness       2.68e-03  1.71e-03    1.57  0.11758    </span></span>
<span><span class="co">#&gt; Response_8: VallyBotFlat    1.80e-03  1.44e-03    1.25  0.20996    </span></span>
<span><span class="co">#&gt; Response_8: PPTann         -6.82e-04  6.98e-04   -0.98  0.32833    </span></span>
<span><span class="co">#&gt; Response_8: Loaminess       1.91e-03  8.18e-04    2.34  0.01945 *  </span></span>
<span><span class="co">#&gt; Response_8: cvTemp         -9.23e-05  9.74e-04   -0.09  0.92447    </span></span>
<span><span class="co">#&gt; Response_8: T0              2.73e-04  3.77e-04    0.72  0.46882    </span></span>
<span><span class="co">#&gt; Response_9: Rockiness       1.41e-03  2.20e-03    0.64  0.52049    </span></span>
<span><span class="co">#&gt; Response_9: Sandiness       3.17e-03  2.27e-03    1.40  0.16233    </span></span>
<span><span class="co">#&gt; Response_9: VallyBotFlat    7.06e-03  2.66e-03    2.66  0.00786 ** </span></span>
<span><span class="co">#&gt; Response_9: PPTann          1.90e-03  2.02e-03    0.94  0.34578    </span></span>
<span><span class="co">#&gt; Response_9: Loaminess       1.61e-04  7.93e-04    0.20  0.83882    </span></span>
<span><span class="co">#&gt; Response_9: cvTemp          2.26e-02  1.16e-02    1.95  0.05168 .  </span></span>
<span><span class="co">#&gt; Response_9: T0              4.74e-04  6.83e-04    0.69  0.48746    </span></span>
<span><span class="co">#&gt; Response_10: Rockiness      2.81e-02  9.37e-03    3.00  0.00269 ** </span></span>
<span><span class="co">#&gt; Response_10: Sandiness      5.37e-04  5.93e-04    0.90  0.36549    </span></span>
<span><span class="co">#&gt; Response_10: VallyBotFlat  -2.39e-04  1.00e-03   -0.24  0.81147    </span></span>
<span><span class="co">#&gt; Response_10: PPTann         1.80e-02  9.49e-03    1.89  0.05819 .  </span></span>
<span><span class="co">#&gt; Response_10: Loaminess      3.59e-04  3.81e-04    0.94  0.34687    </span></span>
<span><span class="co">#&gt; Response_10: cvTemp         2.86e-03  2.45e-03    1.17  0.24322    </span></span>
<span><span class="co">#&gt; Response_10: T0             1.67e-03  1.60e-03    1.05  0.29599    </span></span>
<span><span class="co">#&gt; Response_11: Rockiness     -5.36e-04  1.03e-03   -0.52  0.60262    </span></span>
<span><span class="co">#&gt; Response_11: Sandiness      2.77e-03  1.25e-03    2.22  0.02652 *  </span></span>
<span><span class="co">#&gt; Response_11: VallyBotFlat   1.23e-03  1.39e-03    0.88  0.37851    </span></span>
<span><span class="co">#&gt; Response_11: PPTann        -2.98e-04  7.14e-04   -0.42  0.67697    </span></span>
<span><span class="co">#&gt; Response_11: Loaminess      2.01e-03  7.00e-04    2.86  0.00418 ** </span></span>
<span><span class="co">#&gt; Response_11: cvTemp         1.71e-04  6.88e-04    0.25  0.80368    </span></span>
<span><span class="co">#&gt; Response_11: T0             5.40e-04  6.13e-04    0.88  0.37850    </span></span>
<span><span class="co">#&gt; Response_12: Rockiness      5.43e-03  2.68e-03    2.02  0.04292 *  </span></span>
<span><span class="co">#&gt; Response_12: Sandiness      2.17e-03  1.55e-03    1.40  0.16229    </span></span>
<span><span class="co">#&gt; Response_12: VallyBotFlat   1.26e-02  5.58e-03    2.27  0.02351 *  </span></span>
<span><span class="co">#&gt; Response_12: PPTann         3.04e-03  2.22e-03    1.37  0.17010    </span></span>
<span><span class="co">#&gt; Response_12: Loaminess      1.26e-03  8.84e-04    1.42  0.15572    </span></span>
<span><span class="co">#&gt; Response_12: cvTemp         8.37e-03  4.05e-03    2.07  0.03874 *  </span></span>
<span><span class="co">#&gt; Response_12: T0             5.68e-04  9.91e-04    0.57  0.56688    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;      Average Conditional Effects </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;                                ACE  Std.Err Z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Response_1: Rockiness      0.35906  0.15153    2.37  0.01781 *  </span></span>
<span><span class="co">#&gt; Response_1: Sandiness     -0.11892  0.09271   -1.28  0.19961    </span></span>
<span><span class="co">#&gt; Response_1: VallyBotFlat  -0.07015  0.13079   -0.54  0.59171    </span></span>
<span><span class="co">#&gt; Response_1: PPTann         0.12773  0.11663    1.10  0.27346    </span></span>
<span><span class="co">#&gt; Response_1: Loaminess      0.02714  0.11869    0.23  0.81910    </span></span>
<span><span class="co">#&gt; Response_1: cvTemp         0.30846  0.13131    2.35  0.01882 *  </span></span>
<span><span class="co">#&gt; Response_1: T0             0.11549  0.09502    1.22  0.22420    </span></span>
<span><span class="co">#&gt; Response_2: Rockiness      0.40107  0.18619    2.15  0.03123 *  </span></span>
<span><span class="co">#&gt; Response_2: Sandiness     -0.14671  0.10487   -1.40  0.16184    </span></span>
<span><span class="co">#&gt; Response_2: VallyBotFlat  -0.04357  0.15012   -0.29  0.77166    </span></span>
<span><span class="co">#&gt; Response_2: PPTann        -0.05596  0.15016   -0.37  0.70938    </span></span>
<span><span class="co">#&gt; Response_2: Loaminess      0.04077  0.15285    0.27  0.78968    </span></span>
<span><span class="co">#&gt; Response_2: cvTemp         0.84690  0.28860    2.93  0.00334 ** </span></span>
<span><span class="co">#&gt; Response_2: T0             0.06374  0.10634    0.60  0.54893    </span></span>
<span><span class="co">#&gt; Response_3: Rockiness     -0.17650  0.09166   -1.93  0.05417 .  </span></span>
<span><span class="co">#&gt; Response_3: Sandiness      0.26416  0.11357    2.33  0.02002 *  </span></span>
<span><span class="co">#&gt; Response_3: VallyBotFlat  -0.32401  0.12404   -2.61  0.00900 ** </span></span>
<span><span class="co">#&gt; Response_3: PPTann         0.02462  0.10148    0.24  0.80834    </span></span>
<span><span class="co">#&gt; Response_3: Loaminess     -0.00425  0.08270   -0.05  0.95905    </span></span>
<span><span class="co">#&gt; Response_3: cvTemp        -0.52503  0.14970   -3.51  0.00045 ***</span></span>
<span><span class="co">#&gt; Response_3: T0             0.02196  0.06978    0.31  0.75300    </span></span>
<span><span class="co">#&gt; Response_4: Rockiness     -0.25051  0.13989   -1.79  0.07334 .  </span></span>
<span><span class="co">#&gt; Response_4: Sandiness     -0.50913  0.12440   -4.09  4.3e-05 ***</span></span>
<span><span class="co">#&gt; Response_4: VallyBotFlat   0.63158  0.17226    3.67  0.00025 ***</span></span>
<span><span class="co">#&gt; Response_4: PPTann        -0.30408  0.17308   -1.76  0.07894 .  </span></span>
<span><span class="co">#&gt; Response_4: Loaminess      0.13252  0.14888    0.89  0.37341    </span></span>
<span><span class="co">#&gt; Response_4: cvTemp         0.10623  0.15879    0.67  0.50351    </span></span>
<span><span class="co">#&gt; Response_4: T0             0.05224  0.08505    0.61  0.53913    </span></span>
<span><span class="co">#&gt; Response_5: Rockiness      0.53694  0.24122    2.23  0.02602 *  </span></span>
<span><span class="co">#&gt; Response_5: Sandiness     -0.19346  0.12779   -1.51  0.13006    </span></span>
<span><span class="co">#&gt; Response_5: VallyBotFlat  -0.03056  0.16134   -0.19  0.84975    </span></span>
<span><span class="co">#&gt; Response_5: PPTann        -0.12528  0.17487   -0.72  0.47373    </span></span>
<span><span class="co">#&gt; Response_5: Loaminess      0.02345  0.16987    0.14  0.89018    </span></span>
<span><span class="co">#&gt; Response_5: cvTemp         1.05769  0.32519    3.25  0.00114 ** </span></span>
<span><span class="co">#&gt; Response_5: T0             0.02927  0.12917    0.23  0.82071    </span></span>
<span><span class="co">#&gt; Response_6: Rockiness     -0.20029  0.08850   -2.26  0.02362 *  </span></span>
<span><span class="co">#&gt; Response_6: Sandiness     -0.20359  0.08011   -2.54  0.01104 *  </span></span>
<span><span class="co">#&gt; Response_6: VallyBotFlat   0.23950  0.10307    2.32  0.02015 *  </span></span>
<span><span class="co">#&gt; Response_6: PPTann        -0.24089  0.13314   -1.81  0.07040 .  </span></span>
<span><span class="co">#&gt; Response_6: Loaminess      0.04999  0.08051    0.62  0.53462    </span></span>
<span><span class="co">#&gt; Response_6: cvTemp         0.13116  0.13123    1.00  0.31756    </span></span>
<span><span class="co">#&gt; Response_6: T0             0.10576  0.06765    1.56  0.11794    </span></span>
<span><span class="co">#&gt; Response_7: Rockiness     -0.31887  0.10895   -2.93  0.00343 ** </span></span>
<span><span class="co">#&gt; Response_7: Sandiness     -0.07790  0.05595   -1.39  0.16383    </span></span>
<span><span class="co">#&gt; Response_7: VallyBotFlat  -0.00750  0.11052   -0.07  0.94590    </span></span>
<span><span class="co">#&gt; Response_7: PPTann        -0.11842  0.08613   -1.37  0.16919    </span></span>
<span><span class="co">#&gt; Response_7: Loaminess      0.15935  0.11123    1.43  0.15197    </span></span>
<span><span class="co">#&gt; Response_7: cvTemp        -0.50305  0.16213   -3.10  0.00192 ** </span></span>
<span><span class="co">#&gt; Response_7: T0             0.01601  0.07609    0.21  0.83332    </span></span>
<span><span class="co">#&gt; Response_8: Rockiness     -0.20924  0.11664   -1.79  0.07283 .  </span></span>
<span><span class="co">#&gt; Response_8: Sandiness     -0.45272  0.12001   -3.77  0.00016 ***</span></span>
<span><span class="co">#&gt; Response_8: VallyBotFlat   0.49980  0.12879    3.88  0.00010 ***</span></span>
<span><span class="co">#&gt; Response_8: PPTann        -0.25507  0.15247   -1.67  0.09434 .  </span></span>
<span><span class="co">#&gt; Response_8: Loaminess      0.10112  0.12528    0.81  0.41959    </span></span>
<span><span class="co">#&gt; Response_8: cvTemp         0.13185  0.13122    1.00  0.31499    </span></span>
<span><span class="co">#&gt; Response_8: T0             0.07172  0.06177    1.16  0.24565    </span></span>
<span><span class="co">#&gt; Response_9: Rockiness     -0.19272  0.15197   -1.27  0.20474    </span></span>
<span><span class="co">#&gt; Response_9: Sandiness      0.06113  0.10497    0.58  0.56033    </span></span>
<span><span class="co">#&gt; Response_9: VallyBotFlat  -0.07676  0.10550   -0.73  0.46686    </span></span>
<span><span class="co">#&gt; Response_9: PPTann        -0.06804  0.11313   -0.60  0.54754    </span></span>
<span><span class="co">#&gt; Response_9: Loaminess      0.12245  0.12286    1.00  0.31893    </span></span>
<span><span class="co">#&gt; Response_9: cvTemp        -0.69281  0.22832   -3.03  0.00241 ** </span></span>
<span><span class="co">#&gt; Response_9: T0             0.05037  0.07740    0.65  0.51519    </span></span>
<span><span class="co">#&gt; Response_10: Rockiness     0.82045  0.25156    3.26  0.00111 ** </span></span>
<span><span class="co">#&gt; Response_10: Sandiness     0.07730  0.13882    0.56  0.57764    </span></span>
<span><span class="co">#&gt; Response_10: VallyBotFlat -0.28682  0.20446   -1.40  0.16067    </span></span>
<span><span class="co">#&gt; Response_10: PPTann        0.62504  0.19852    3.15  0.00164 ** </span></span>
<span><span class="co">#&gt; Response_10: Loaminess     0.06722  0.18230    0.37  0.71231    </span></span>
<span><span class="co">#&gt; Response_10: cvTemp        0.06298  0.20704    0.30  0.76099    </span></span>
<span><span class="co">#&gt; Response_10: T0            0.05253  0.10694    0.49  0.62329    </span></span>
<span><span class="co">#&gt; Response_11: Rockiness    -0.21390  0.10224   -2.09  0.03643 *  </span></span>
<span><span class="co">#&gt; Response_11: Sandiness    -0.36330  0.11495   -3.16  0.00157 ** </span></span>
<span><span class="co">#&gt; Response_11: VallyBotFlat  0.37668  0.12583    2.99  0.00276 ** </span></span>
<span><span class="co">#&gt; Response_11: PPTann       -0.23841  0.15984   -1.49  0.13580    </span></span>
<span><span class="co">#&gt; Response_11: Loaminess     0.07834  0.10928    0.72  0.47344    </span></span>
<span><span class="co">#&gt; Response_11: cvTemp        0.00393  0.11881    0.03  0.97363    </span></span>
<span><span class="co">#&gt; Response_11: T0            0.07112  0.06335    1.12  0.26161    </span></span>
<span><span class="co">#&gt; Response_12: Rockiness    -0.56299  0.17774   -3.17  0.00154 ** </span></span>
<span><span class="co">#&gt; Response_12: Sandiness    -0.19772  0.11224   -1.76  0.07815 .  </span></span>
<span><span class="co">#&gt; Response_12: VallyBotFlat  0.49573  0.16552    2.99  0.00275 ** </span></span>
<span><span class="co">#&gt; Response_12: PPTann       -0.38170  0.16135   -2.37  0.01800 *  </span></span>
<span><span class="co">#&gt; Response_12: Loaminess     0.06807  0.10746    0.63  0.52645    </span></span>
<span><span class="co">#&gt; Response_12: cvTemp       -0.46701  0.20745   -2.25  0.02437 *  </span></span>
<span><span class="co">#&gt; Response_12: T0            0.00997  0.10264    0.10  0.92264    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;      Standard Deviation of Conditional Effects </span></span>
<span><span class="co">#&gt;  ##########################################################</span></span>
<span><span class="co">#&gt;                              ACE Std.Err Z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; Response_1: Rockiness     0.2422  0.0688    3.52  0.00043 ***</span></span>
<span><span class="co">#&gt; Response_1: Sandiness     0.1986  0.0427    4.65  3.2e-06 ***</span></span>
<span><span class="co">#&gt; Response_1: VallyBotFlat  0.2228  0.0483    4.61  4.1e-06 ***</span></span>
<span><span class="co">#&gt; Response_1: PPTann        0.1787  0.0486    3.67  0.00024 ***</span></span>
<span><span class="co">#&gt; Response_1: Loaminess     0.1168  0.0284    4.10  4.0e-05 ***</span></span>
<span><span class="co">#&gt; Response_1: cvTemp        0.2383  0.0611    3.90  9.6e-05 ***</span></span>
<span><span class="co">#&gt; Response_1: T0            0.1447  0.0302    4.79  1.6e-06 ***</span></span>
<span><span class="co">#&gt; Response_2: Rockiness     0.2720  0.0725    3.75  0.00018 ***</span></span>
<span><span class="co">#&gt; Response_2: Sandiness     0.2317  0.0401    5.78  7.6e-09 ***</span></span>
<span><span class="co">#&gt; Response_2: VallyBotFlat  0.2434  0.0559    4.36  1.3e-05 ***</span></span>
<span><span class="co">#&gt; Response_2: PPTann        0.2304  0.0618    3.73  0.00019 ***</span></span>
<span><span class="co">#&gt; Response_2: Loaminess     0.1584  0.0515    3.08  0.00209 ** </span></span>
<span><span class="co">#&gt; Response_2: cvTemp        0.2975  0.0916    3.25  0.00116 ** </span></span>
<span><span class="co">#&gt; Response_2: T0            0.1690  0.0442    3.82  0.00013 ***</span></span>
<span><span class="co">#&gt; Response_3: Rockiness     0.1639  0.0646    2.54  0.01122 *  </span></span>
<span><span class="co">#&gt; Response_3: Sandiness     0.1340  0.0408    3.28  0.00102 ** </span></span>
<span><span class="co">#&gt; Response_3: VallyBotFlat  0.1710  0.0592    2.89  0.00390 ** </span></span>
<span><span class="co">#&gt; Response_3: PPTann        0.1436  0.0530    2.71  0.00675 ** </span></span>
<span><span class="co">#&gt; Response_3: Loaminess     0.0827  0.0262    3.15  0.00161 ** </span></span>
<span><span class="co">#&gt; Response_3: cvTemp        0.1772  0.0535    3.31  0.00092 ***</span></span>
<span><span class="co">#&gt; Response_3: T0            0.0980  0.0246    3.98  6.9e-05 ***</span></span>
<span><span class="co">#&gt; Response_4: Rockiness     0.2930  0.0680    4.31  1.6e-05 ***</span></span>
<span><span class="co">#&gt; Response_4: Sandiness     0.2694  0.0584    4.61  4.0e-06 ***</span></span>
<span><span class="co">#&gt; Response_4: VallyBotFlat  0.2753  0.0587    4.69  2.7e-06 ***</span></span>
<span><span class="co">#&gt; Response_4: PPTann        0.2586  0.0664    3.90  9.8e-05 ***</span></span>
<span><span class="co">#&gt; Response_4: Loaminess     0.1567  0.0398    3.93  8.4e-05 ***</span></span>
<span><span class="co">#&gt; Response_4: cvTemp        0.2855  0.0713    4.00  6.3e-05 ***</span></span>
<span><span class="co">#&gt; Response_4: T0            0.1590  0.0395    4.02  5.8e-05 ***</span></span>
<span><span class="co">#&gt; Response_5: Rockiness     0.2925  0.0767    3.81  0.00014 ***</span></span>
<span><span class="co">#&gt; Response_5: Sandiness     0.2505  0.0554    4.53  6.0e-06 ***</span></span>
<span><span class="co">#&gt; Response_5: VallyBotFlat  0.2675  0.0700    3.82  0.00013 ***</span></span>
<span><span class="co">#&gt; Response_5: PPTann        0.2597  0.0781    3.32  0.00089 ***</span></span>
<span><span class="co">#&gt; Response_5: Loaminess     0.1779  0.0631    2.82  0.00477 ** </span></span>
<span><span class="co">#&gt; Response_5: cvTemp        0.3299  0.0986    3.34  0.00082 ***</span></span>
<span><span class="co">#&gt; Response_5: T0            0.1797  0.0536    3.36  0.00079 ***</span></span>
<span><span class="co">#&gt; Response_6: Rockiness     0.2648  0.0574    4.61  4.0e-06 ***</span></span>
<span><span class="co">#&gt; Response_6: Sandiness     0.2159  0.0486    4.44  8.8e-06 ***</span></span>
<span><span class="co">#&gt; Response_6: VallyBotFlat  0.2448  0.0591    4.14  3.4e-05 ***</span></span>
<span><span class="co">#&gt; Response_6: PPTann        0.2315  0.0620    3.73  0.00019 ***</span></span>
<span><span class="co">#&gt; Response_6: Loaminess     0.1174  0.0223    5.27  1.4e-07 ***</span></span>
<span><span class="co">#&gt; Response_6: cvTemp        0.2215  0.0548    4.04  5.3e-05 ***</span></span>
<span><span class="co">#&gt; Response_6: T0            0.1342  0.0312    4.31  1.7e-05 ***</span></span>
<span><span class="co">#&gt; Response_7: Rockiness     0.1697  0.0507    3.35  0.00082 ***</span></span>
<span><span class="co">#&gt; Response_7: Sandiness     0.1372  0.0477    2.88  0.00402 ** </span></span>
<span><span class="co">#&gt; Response_7: VallyBotFlat  0.1779  0.0549    3.24  0.00119 ** </span></span>
<span><span class="co">#&gt; Response_7: PPTann        0.1627  0.0496    3.28  0.00103 ** </span></span>
<span><span class="co">#&gt; Response_7: Loaminess     0.0893  0.0334    2.67  0.00756 ** </span></span>
<span><span class="co">#&gt; Response_7: cvTemp        0.1717  0.0435    3.94  8.0e-05 ***</span></span>
<span><span class="co">#&gt; Response_7: T0            0.0951  0.0221    4.31  1.6e-05 ***</span></span>
<span><span class="co">#&gt; Response_8: Rockiness     0.2809  0.0708    3.97  7.3e-05 ***</span></span>
<span><span class="co">#&gt; Response_8: Sandiness     0.2519  0.0584    4.31  1.6e-05 ***</span></span>
<span><span class="co">#&gt; Response_8: VallyBotFlat  0.2769  0.0631    4.39  1.1e-05 ***</span></span>
<span><span class="co">#&gt; Response_8: PPTann        0.2554  0.0616    4.15  3.4e-05 ***</span></span>
<span><span class="co">#&gt; Response_8: Loaminess     0.1466  0.0331    4.43  9.3e-06 ***</span></span>
<span><span class="co">#&gt; Response_8: cvTemp        0.2637  0.0688    3.83  0.00013 ***</span></span>
<span><span class="co">#&gt; Response_8: T0            0.1548  0.0378    4.10  4.2e-05 ***</span></span>
<span><span class="co">#&gt; Response_9: Rockiness     0.2227  0.0585    3.81  0.00014 ***</span></span>
<span><span class="co">#&gt; Response_9: Sandiness     0.1711  0.0527    3.25  0.00116 ** </span></span>
<span><span class="co">#&gt; Response_9: VallyBotFlat  0.2211  0.0561    3.94  8.2e-05 ***</span></span>
<span><span class="co">#&gt; Response_9: PPTann        0.1990  0.0631    3.16  0.00160 ** </span></span>
<span><span class="co">#&gt; Response_9: Loaminess     0.1035  0.0331    3.13  0.00176 ** </span></span>
<span><span class="co">#&gt; Response_9: cvTemp        0.2358  0.0657    3.59  0.00033 ***</span></span>
<span><span class="co">#&gt; Response_9: T0            0.1326  0.0304    4.36  1.3e-05 ***</span></span>
<span><span class="co">#&gt; Response_10: Rockiness    0.2921  0.0836    3.49  0.00048 ***</span></span>
<span><span class="co">#&gt; Response_10: Sandiness    0.1978  0.0442    4.47  7.8e-06 ***</span></span>
<span><span class="co">#&gt; Response_10: VallyBotFlat 0.2307  0.0619    3.72  0.00020 ***</span></span>
<span><span class="co">#&gt; Response_10: PPTann       0.2042  0.0562    3.64  0.00028 ***</span></span>
<span><span class="co">#&gt; Response_10: Loaminess    0.1392  0.0299    4.66  3.2e-06 ***</span></span>
<span><span class="co">#&gt; Response_10: cvTemp       0.2791  0.0716    3.90  9.8e-05 ***</span></span>
<span><span class="co">#&gt; Response_10: T0           0.1932  0.0520    3.72  0.00020 ***</span></span>
<span><span class="co">#&gt; Response_11: Rockiness    0.2638  0.0744    3.55  0.00039 ***</span></span>
<span><span class="co">#&gt; Response_11: Sandiness    0.2308  0.0522    4.42  9.8e-06 ***</span></span>
<span><span class="co">#&gt; Response_11: VallyBotFlat 0.2486  0.0613    4.06  5.0e-05 ***</span></span>
<span><span class="co">#&gt; Response_11: PPTann       0.2369  0.0654    3.62  0.00029 ***</span></span>
<span><span class="co">#&gt; Response_11: Loaminess    0.1264  0.0276    4.58  4.7e-06 ***</span></span>
<span><span class="co">#&gt; Response_11: cvTemp       0.2345  0.0589    3.98  6.9e-05 ***</span></span>
<span><span class="co">#&gt; Response_11: T0           0.1430  0.0332    4.30  1.7e-05 ***</span></span>
<span><span class="co">#&gt; Response_12: Rockiness    0.2436  0.0718    3.39  0.00069 ***</span></span>
<span><span class="co">#&gt; Response_12: Sandiness    0.1978  0.0684    2.89  0.00383 ** </span></span>
<span><span class="co">#&gt; Response_12: VallyBotFlat 0.2184  0.0717    3.05  0.00231 ** </span></span>
<span><span class="co">#&gt; Response_12: PPTann       0.2321  0.0748    3.10  0.00193 ** </span></span>
<span><span class="co">#&gt; Response_12: Loaminess    0.1208  0.0437    2.76  0.00570 ** </span></span>
<span><span class="co">#&gt; Response_12: cvTemp       0.2066  0.0616    3.35  0.00080 ***</span></span>
<span><span class="co">#&gt; Response_12: T0           0.1246  0.0353    3.53  0.00041 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>cvTemp is significant for many species. Visualization of the
effect:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ale_plots</span> <span class="op">=</span> <span class="fu"><a href="../reference/ALE.html">ALE</a></span><span class="op">(</span><span class="va">model_boot</span>, variable <span class="op">=</span> <span class="st">"cvTemp"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">gridExtra</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span>, <span class="va">ale_plots</span><span class="op">)</span></span></code></pre></div>
<p><img src="C-Example_Species_distribution_modeling_files/figure-html/unnamed-chunk-24-1.png" width="400px" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Christian Amesöder, Maximilian Pichler.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
